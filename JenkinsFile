pipeline {
    agent any
    stages {
        stage('Install Dependencies') { 
            steps {
                bat 'npm install newman'
                bat 'npm install newman-reporter-htmlextra'
            }
        }
        stage('Run API Tests') { 
            steps {
                bat 'npx newman run collections/BookingAPICollection.json -e environments/BookingAPIEnv.json -r htmlextra --reporter-htmlextra-export=newman-report/report.html -d testdata/testData.json'
            }
        }
    }
    post {
        always {
            archiveArtifacts artifacts: 'newman-report/report.html', allowEmptyArchive: true
        }
    }
}
